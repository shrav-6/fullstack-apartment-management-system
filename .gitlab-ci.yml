frontend-build:
    stage: build
    image: node:16.20.1
    script: 
        - echo "🏃‍♀️ running frontend build job"
        - cd frontend/
        - yarn install
        - yarn add vite
        - yarn run build
        - echo "✅ frontend build completed succesfully!"

backend-build:
    stage: build
    image: node:16.20.1
    script: 
        - echo "🏃‍♀️ running backend build job"
        - cd frontend/
        - npm install
        - npm run build
        - echo "✅ backend build completed succesfully!"


backend-test:
    stage: test
    script:
        - echo "starting test"
        - cd backend/
        - npm install
        - npm run build
        - npm run build-test
        - npm run test
        - echo "all the backend tests ran successfully!"

publish:
  image: docker:latest
  stage: publish
  tags: 
    - deployment
  variables:
    DOCKER_TLS_CERTDIR: ""
    DOCKER_HOST: "tcp://docker:2375"
  services:
    - docker:dind

 
  script:
    - pwd 
    - echo $SERVER_IP
    - docker --version
    - docker login -u $DOCKER_HUB_USER -p $DOCKER_HUB_PWD docker.io
    - docker build -t docker.io/csci5308vm18/shelter:$CI_COMMIT_SHORT_SHA .
    - docker push docker.io/csci5308vm18/shelter:$CI_COMMIT_SHORT_SHA
  only:
    - main
